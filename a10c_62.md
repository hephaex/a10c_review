# ARM10C 62주차 후기
##### 일시 : 2014.07.12 (62주차)
##### 모임명 : NAVER개발자커뮤니티지원_IAMROOT.ORG_10차ARM-C
##### 장소 : 토즈 타워점
##### 장소지원 : NAVER 개발자 커뮤니티 지원 프로그램
##### 참여인원 :  5명

## 스터디 진도 : 
 - mm_init()을 계속 분석합니다.
 - start_kernel()-> mm_init()->kmem_cache_init()->bootstrap()분석중
 - bootstrap()은 두번 실행됩니다.
 - 1번째는 &boot_kmem_cache 매개변수를 가지고
 - 2번째는 &boot_kmem_cache_node 매개변수를 가지고 실행합니다.

## main.c::mm_init()
```
static void __init mm_init(void)
{
	page_cgroup_init_flatmem(); // null function
	mem_init();
	// bootmem으로 관리하던 메모리를 buddy로 이관.
	// 각 section 메모리 크기를 출력.
	
	// mm/Makefile 에서 CONFIG_SLUB 설정으로 slub.c 로 jump
	kmem_cache_init();
```
// mm/Makefile 에서 CONFIG_SLUB 설정으로 slub.c 로 jump
> kmem_cache_init();

## slub.c::kmem_cache_init()
```
void __init kmem_cache_init(void)
{
...
	create_boot_cache(kmem_cache_node, "kmem_cache_node",
		sizeof(struct kmem_cache_node), SLAB_HWCACHE_ALIGN);
...
	slab_state = PARTIAL;
...	
    create_boot_cache(kmem_cache, "kmem_cache",
			offsetof(struct kmem_cache, node) +
				nr_node_ids * sizeof(struct kmem_cache_node *),
		       SLAB_HWCACHE_ALIGN);
			   
	kmem_cache = bootstrap(&boot_kmem_cache);

	kmem_cache_node = bootstrap(&boot_kmem_cache_node);
```
> kmem_cache_node = bootstrap(&boot_kmem_cache_node);

## slub.c::bootstrap()
// struct kmem_cache * static_cache: &&boot_kmem_cache_node
```
static struct kmem_cache * __init bootstrap(struct kmem_cache *static_cache)
{
	int node;

	struct kmem_cache *s = kmem_cache_zalloc(kmem_cache, GFP_NOWAIT);

	memcpy(s, static_cache, kmem_cache->object_size);

	__flush_cpu_slab(s, smp_processor_id());
```
// s: UNMOVABLE인 page (boot_kmem_cache_node)의 object의 시작 virtual address,
// smp_processor_id(): 0
> __flush_cpu_slab(s, smp_processor_id());


## study log
```
10996da..fea5705  master     -> origin/master
Merge made by the 'recursive' strategy.
arch/arm/include/asm/processor.h |   2 +
include/linux/kmemcheck.h        |   1 +
include/linux/kmemleak.h         |   1 +
include/linux/mm.h               |   1 +
include/linux/percpu.h           |  63 +++--
include/linux/slab.h             |   3 +-
include/linux/slub_def.h         |   2 +
include/trace/events/kmem.h      |   1 +
mm/slab_common.c                 |   1 +
mm/slub.c                        | 532 ++++++++++++++++++++++++++++++++++++++-
10 files changed, 571 insertions(+), 36 deletions(-)
```			
