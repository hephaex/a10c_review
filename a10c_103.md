##### ARM10C   : 103 주차 
##### 일시     : 2015.05.30 (103 주차 스터디 진행)
##### 모임명   : NAVER개발자커뮤니티지원_IAMROOT.ORG_10차ARM-C
##### 장소     : 토즈 타워점
##### 장소지원 : NAVER 개발자 커뮤니티 지원 프로그램
##### 참여인원 :  3명
============

## 103 주차 진도

1  1 start_kernel        1  ~/kernel/iamroot/linux-stable/init/main.c
2  1 time_init         743  ~/kernel/iamroot/linux-stable/init/main.c
3  1 clocksource_of_init   557  ~/kernel/iamroot/linux-stable/arch/arm/kernel/time.c
4  1 mct_init_spi       56  ~/kernel/iamroot/linux-stable/drivers/clocksource/clksrc-of.c
5  1 mct_init_dt      1420  return mct_init_dt(np, MCT_INT_SPI);
6  1 exynos4_clocksource_init  1410  exynos4_clocksource_init();
7  1 exynos4_mct_frc_start   425  exynos4_mct_frc_start(0, 0)


## main.c::main.c()
* called: start_kernel()->time_init()

```
asmlinkage void __init start_kernel(void)
{
...
        sched_clock_postinit();
```

## sched_clock.c::sched_clockinit()
* call: start_kernel()->sched_clock_postinit()

```
void __init sched_clock_postinit(void)
{
	/*
	 * If no sched_clock function has been provided at that point,
	 * make it the final one one.
	 */
	if (read_sched_clock == jiffy_sched_clock_read)
		sched_clock_register(jiffy_sched_clock_read, BITS_PER_LONG, HZ);
```

* call: start_kernel()->sched_clock_postinit()->sched_clock_register()

## sched_clock.c

```
void __init sched_clock_register(u64 (*read)(void), int bits,
				 unsigned long rate)
{
	unsigned long r;
	u64 res, wrap;
	char r_unit;

    // cd.rate: 0, rate: 100
	if (cd.rate > rate)
		return;

    // irqs_disabled(): 1
	WARN_ON(!irqs_disabled());
	// read_sched_clock: read: jiffy_sched_clock_read
	read_sched_clock = read;
	// sched_clock_mask: CLOCKSOURCE_MASK(bits: 32):
	// #define CLOCKSOURCE_MASK(bits) (cycle_t)((bits) < 64 ? ((1ULL<<(bits))-1) : -1)
	// sched_clock_mask: 0xffffffff
	sched_clock_mask = CLOCKSOURCE_MASK(bits);
	// cd.rate: rate: 100
	cd.rate = rate;

	/* calculate the mult/shift to convert counter ticks to ns. */
	clocks_calc_mult_shift(&cd.mult, &cd.shift, rate, NSEC_PER_SEC, 3600);
	// clock_calc_mult_shift():
	// (&cd)->mult: 0x98968000
	// (&cd)->shift: 8

